language: go

matrix:
  include:
  - go: 1.x
    env: LATEST=true

git:
  depth: 1

notifications:
  email: false

before_install:
- go get github.com/mitchellh/gox
script:
- go get -t -v ./...
- diff -u <(echo -n) <(gofmt -d .)
- go vet $(go list ./... | grep -v /vendor/)
- go test -v -race ./...
- if [ "${LATEST}" = "true" ]; then gox -os="linux darwin" -arch="amd64" -output="sshs.{{.OS}}.{{.Arch}}" -ldflags "-X main.Rev=`git rev-parse --short HEAD`" -verbose ./...; fi

deploy:
  provider: releases
  skip_cleanup: true
  api_key:
    secure: PvkCMwL451/GQjwvj7SbzI1dwd03I1qUGesFbpiGxiyXIlyDIksBeguBJnPKOu7wQmq2OoXypVEnbJpZ45z9KLCHHTp5cZ9aC21EPB+EzsW3SCAziQbqwRRshmfSt4tVYr0ib1hTLoqeAWdY/jWbjNuOvZDndD4qJKxnFM+f3BvlGbWa+UJxysDIcypStsMISetc9eMAFcZBKQmfWzbjBh3aCC8KOVol2WB+TgtRbrxPtExqJPqhNXMa59BLqDkAvnJ6crQP6CCFcPNfHCGx91D7I8jEuXkcEzvw3vVTSe6Z28f6dkUlLCPTwwiWm7AXjweB5v2j/CWJAHJVGufujc7YTqn7EWx+iDWyTQ6LRIOdOmRf1suMCY9TKO2BYLMNO0LvihLpxor+sw6fZInYHw2ZAeWx3k7kpfd43r354xDyBuFUcI70HeyueWeI4y9vbkSkrGPGPKX7MEJSjHCFTJ3vJFPsng33ldDhhU3Sgvg9D8qurSQ89mxNGoqom+/AYq1DAX6Nmqghl5C4tfrwO/p+tgX9dVhC+g30+7afFBght2a1R5LUqih1BnS2Meeawyv/uGCn62hysGX41o+2tyDYPzl7us5EbLWkajCKDQoV38rQfnWym+W7Mv9oxctD2uGSTjzxEgtE5IF0ILJDSyCZZWn66aOoZzihJfyJUoI=
  file:
    - sshs.linux.amd64
    - sshs.darwin.amd64
  on:
    repo: davemcphee/sshs
    tags: true
    condition: $LATEST = true
